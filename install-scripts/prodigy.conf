upstream app {
  server localhost:3000 fail_timeout=20s;
  keepalive 32;
}

upstream prodigyimages {
  server localhost:8090  fail_timeout=20s;
  keepalive 32;
}

upstream layoutanalysis01 {
  server localhost:8010  fail_timeout=20s;
  keepalive 32;
}

upstream layoutanalysis02 {
  server localhost:8020  fail_timeout=20s;
  keepalive 32;
}

upstream layoutanalysis03 {
  server localhost:8030  fail_timeout=20s;
  keepalive 32;
}

upstream scriptdetection {
  server localhost:8050 fail_timeout=20s;
  keepalive 32;
}

upstream reviewlayoutannotation {
  server localhost:8060 fail_timeout=20s;
  keepalive 32;
}

upstream stt_ab {
  server localhost:8110 fail_timeout=20s;
  keepalive 32;
}

upstream stt_cs {
  server localhost:8120 fail_timeout=20s;
  keepalive 32;
}

upstream stt_mv_ga {
  server localhost:8131 fail_timeout=20s;
  keepalive 32;
}

upstream stt_mv_gb {
  server localhost:8132 fail_timeout=20s;
  keepalive 32;
}

upstream stt_mv_gc {
  server localhost:8133 fail_timeout=20s;
  keepalive 32;
}

upstream stt_mv_gd {
  server localhost:8134 fail_timeout=20s;
  keepalive 32;
}

upstream stt_ns {
  server localhost:8140 fail_timeout=20s;
  keepalive 32;
}

upstream stt_tt_ga {
  server localhost:8151 fail_timeout=20s;
  keepalive 32;
}

upstream stt_tt_gb {
  server localhost:8152 fail_timeout=20s;
  keepalive 32;
}

upstream stt_tt_gc {
  server localhost:8153 fail_timeout=20s;
  keepalive 32;
}

upstream stt_tt_gd {
  server localhost:8154 fail_timeout=20s;
  keepalive 32;
}

upstream stt_tt_ge {
  server localhost:8155 fail_timeout=20s;
  keepalive 32;
}

upstream stt_tt_gf {
  server localhost:8156 fail_timeout=20s;
  keepalive 32;
}

upstream stt_tt_gg {
  server localhost:8157 fail_timeout=20s;
  keepalive 32;
}

upstream stt_cs_review {
  server localhost:8160 fail_timeout=20s;
  keepalive 32;
}

upstream stt_mv_ga_review {
  server localhost:8171 fail_timeout=20s;
  keepalive 32;
}

upstream stt_mv_gb_review {
  server localhost:8172 fail_timeout=20s;
  keepalive 32;
}

upstream stt_mv_gc_review {
  server localhost:8173 fail_timeout=20s;
  keepalive 32;
}

upstream stt_mv_gd_review {
  server localhost:8174 fail_timeout=20s;
  keepalive 32;
}

upstream stt_ns_review {
  server localhost:8180 fail_timeout=20s;
  keepalive 32;
}

upstream stt_tt_ga_review {
  server localhost:8191 fail_timeout=20s;
  keepalive 32;
}

upstream stt_tt_gb_review {
  server localhost:8192 fail_timeout=20s;
  keepalive 32;
}

upstream stt_tt_gc_review {
  server localhost:8193 fail_timeout=20s;
  keepalive 32;
}

upstream stt_tt_gd_review {
  server localhost:8194 fail_timeout=20s;
  keepalive 32;
}

upstream stt_tt_ge_review {
  server localhost:8195 fail_timeout=20s;
  keepalive 32;
}

upstream stt_tt_gf_review {
  server localhost:8196 fail_timeout=20s;
  keepalive 32;
}

upstream stt_tt_gg_review {
  server localhost:8197 fail_timeout=20s;
  keepalive 32;
}

server {
    listen 80;

    # listen 443 ssl;
    # ssl_certificate      /etc/letsencrypt/live/prodigy.bdrc.io/fullchain.pem;
    # ssl_certificate_key  /etc/letsencrypt/live/prodigy.bdrc.io/privkey.pem;
    # include ssl_params;

    server_name prodigy.bdrc.io ;

    location / {
        proxy_pass http://app/;
        proxy_http_version   1.1;
        proxy_redirect       off;
        proxy_set_header  Connection         "";
        proxy_set_header  Host               $host;
        proxy_set_header  X-Real-IP          $remote_addr;
        proxy_set_header  X-Forwarded-For    $proxy_add_x_forwarded_for;
        proxy_set_header  X-Forwarded-Proto  $scheme;
    }

    location /crop_images/ {
        proxy_pass http://prodigyimages/;
        proxy_http_version   1.1;
        proxy_redirect       off;
        proxy_set_header  Connection         "";
        proxy_set_header  Host               $host;
        proxy_set_header  X-Real-IP          $remote_addr;
        proxy_set_header  X-Forwarded-For    $proxy_add_x_forwarded_for;
        proxy_set_header  X-Forwarded-Proto  $scheme;
    }
    location /layout_analysis_01/ {
        proxy_pass http://layoutanalysis01/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /layout_analysis_02/ {
        proxy_pass http://layoutanalysis02/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /layout_analysis_03/ {
        proxy_pass http://layoutanalysis03/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /script_detection/ {
        proxy_pass http://scriptdetection/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /review_layout_annotation/ {
        proxy_pass http://reviewlayoutannotation/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /stt_ab/ {
        proxy_pass http://stt_ab/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /stt_cs/ {
        proxy_pass http://stt_cs/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /stt_mv_ga/ {
        proxy_pass http://stt_mv_ga/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /stt_mv_gb/ {
        proxy_pass http://stt_mv_gb/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /stt_mv_gc/ {
        proxy_pass http://stt_mv_gc/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /stt_mv_gd/ {
        proxy_pass http://stt_mv_gd/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /stt_ns/ {
        proxy_pass http://stt_ns/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /stt_tt_ga/ {
        proxy_pass http://stt_tt_ga/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /stt_tt_gb/ {
        proxy_pass http://stt_tt_gb/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /stt_tt_gc/ {
        proxy_pass http://stt_tt_gc/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /stt_tt_gd/ {
        proxy_pass http://stt_tt_gd/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /stt_tt_ge/ {
        proxy_pass http://stt_tt_ge/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /stt_tt_gf/ {
        proxy_pass http://stt_tt_gf/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /stt_tt_gg/ {
        proxy_pass http://stt_tt_gg/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /stt_cs_review/ {
        proxy_pass http://stt_cs_review/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /stt_mv_ga_review/ {
        proxy_pass http://stt_mv_ga_review/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /stt_mv_gb_review/ {
        proxy_pass http://stt_mv_gb_review/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /stt_mv_gc_review/ {
        proxy_pass http://stt_mv_gc_review/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /stt_mv_gd_review/ {
        proxy_pass http://stt_mv_gd_review/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /stt_ns_review/ {
        proxy_pass http://stt_ns_review/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /stt_tt_ga_review/ {
        proxy_pass http://stt_tt_ga_review/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /stt_tt_gb_review/ {
        proxy_pass http://stt_tt_gb_review/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /stt_tt_gc_review/ {
        proxy_pass http://stt_tt_gc_review/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /stt_tt_gd_review/ {
        proxy_pass http://stt_tt_gd_review/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /stt_tt_ge_review/ {
        proxy_pass http://stt_tt_ge_review/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /stt_tt_gf_review/ {
        proxy_pass http://stt_tt_gf_review/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /stt_tt_gg_review/ {
        proxy_pass http://stt_tt_gg_review/;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    include acmechallenge.conf;

    gzip_min_length     1000;
    gzip_buffers        4 8k;
    gzip_types          text/plain text/css;
    gzip_vary           on;
    gzip on ;

    proxy_set_header Host              $http_host;
    proxy_set_header X-Forwarded-For   $remote_addr;
    proxy_set_header X-Forwarded-Proto $scheme;
}
